---
interface Props {
  event: {
    id: number;
    title: string;
    date: string;
    time?: string;
    location: string;
    description?: string;
    category: string;
    tags?: string[];
    url?: string;
    source?: string;
    region?: string;
    isHighlight?: boolean;
  };
  regions?: Record<string, { name: string; emoji: string }>;
}

const { event, regions = {} } = Astro.props;

const date = new Date(event.date);
const day = date.getDate();
const month = date.toLocaleDateString('de-DE', { month: 'short' });
const weekday = date.toLocaleDateString('de-DE', { weekday: 'short' });

const categoryConfig = {
  kinder: { emoji: 'üë∂', label: 'Kinder', color: 'var(--color-kinder)' },
  familie: { emoji: 'üë®‚Äçüë©‚Äçüëß', label: 'Familie', color: 'var(--color-familie)' },
  erwachsene: { emoji: 'üé≠', label: 'Erwachsene', color: 'var(--color-erwachsene)' }
};

const cat = categoryConfig[event.category as keyof typeof categoryConfig] || categoryConfig.familie;
const regionInfo = event.region && regions[event.region];
---

<article 
  class="event-card"
  class:list={[{ 'is-highlight': event.isHighlight }]}
  data-category={event.category}
  data-region={event.region}
  data-location={event.location}
>
  <!-- Date Column -->
  <div class="date-col">
    <div class="date-badge">
      <span class="date-weekday">{weekday}</span>
      <span class="date-day">{day}</span>
      <span class="date-month">{month}</span>
    </div>
    {event.isHighlight && <span class="highlight-star" title="Highlight Event">‚≠ê</span>}
  </div>
  
  <!-- Content Column -->
  <div class="content-col">
    <!-- Header Row -->
    <div class="card-header">
      <span class="category-badge" style={`--cat-color: ${cat.color}`}>
        {cat.emoji} {cat.label}
      </span>
      {event.time && <span class="time-badge">{event.time}</span>}
    </div>
    
    <!-- Title -->
    <h3 class="title">
      {event.url ? (
        <a href={event.url} target="_blank" rel="noopener">{event.title}</a>
      ) : (
        event.title
      )}
    </h3>
    
    <!-- Location -->
    <div class="location">
      <span class="location-pin">üìç</span>
      <span class="location-text">{event.location}</span>
      {regionInfo && (
        <span class="region-badge">{regionInfo.emoji}</span>
      )}
    </div>
    
    <!-- Description -->
    {event.description && (
      <p class="description">{event.description}</p>
    )}
    
    <!-- Footer -->
    <div class="card-footer">
      {event.tags && event.tags.length > 0 && (
        <div class="tags">
          {event.tags.slice(0, 2).map(tag => (
            <span class="tag">#{tag}</span>
          ))}
        </div>
      )}
      {event.source && (
        <span class="source">{event.source}</span>
      )}
    </div>
  </div>
</article>

<style>
  .event-card {
    display: flex;
    gap: 14px;
    background: var(--color-card);
    border-radius: var(--radius-lg);
    padding: 16px;
    border: 1px solid var(--color-border-light);
    box-shadow: var(--shadow-sm);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  @media (min-width: 640px) {
    .event-card {
      gap: 18px;
      padding: 20px;
    }
  }

  .event-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent 50%, rgba(99, 102, 241, 0.02) 100%);
    opacity: 0;
    transition: opacity 0.25s;
  }

  .event-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    border-color: rgba(99, 102, 241, 0.15);
  }

  .event-card:hover::before {
    opacity: 1;
  }

  .event-card.is-highlight {
    background: linear-gradient(135deg, #fffbeb 0%, #fef9e7 100%);
    border-color: rgba(251, 191, 36, 0.3);
  }

  .event-card.is-highlight::before {
    background: linear-gradient(135deg, transparent 50%, rgba(251, 191, 36, 0.05) 100%);
  }

  /* Date Column */
  .date-col {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .date-badge {
    width: 56px;
    padding: 10px 6px;
    background: linear-gradient(145deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: var(--radius-md);
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    text-align: center;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
  }

  @media (min-width: 640px) {
    .date-badge {
      width: 64px;
      padding: 12px 8px;
    }
  }

  .date-weekday {
    font-size: 0.6rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.85;
  }

  .date-day {
    font-size: 1.5rem;
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: -0.02em;
  }

  @media (min-width: 640px) {
    .date-day {
      font-size: 1.75rem;
    }
  }

  .date-month {
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    opacity: 0.9;
    letter-spacing: 0.3px;
  }

  .highlight-star {
    font-size: 1.1rem;
    filter: drop-shadow(0 2px 4px rgba(251, 191, 36, 0.4));
  }

  /* Content Column */
  .content-col {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .category-badge {
    font-size: 0.7rem;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: var(--radius-full);
    background: color-mix(in srgb, var(--cat-color) 12%, transparent);
    color: color-mix(in srgb, var(--cat-color) 85%, black);
  }

  .time-badge {
    font-size: 0.75rem;
    color: var(--color-text-secondary);
    font-weight: 600;
    padding: 2px 0;
  }

  .title {
    font-size: 1.05rem;
    font-weight: 700;
    line-height: 1.35;
    color: var(--color-text);
    letter-spacing: -0.01em;
  }

  @media (min-width: 640px) {
    .title {
      font-size: 1.1rem;
    }
  }

  .title a {
    color: inherit;
    transition: color 0.2s;
  }

  .title a:hover {
    color: var(--color-primary);
  }

  .location {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.8rem;
    color: var(--color-text-secondary);
  }

  .location-pin {
    font-size: 0.75rem;
  }

  .region-badge {
    margin-left: 4px;
    font-size: 0.85rem;
  }

  .description {
    font-size: 0.82rem;
    color: var(--color-text-secondary);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    padding-top: 6px;
  }

  .tags {
    display: flex;
    gap: 6px;
  }

  .tag {
    font-size: 0.65rem;
    font-weight: 500;
    color: var(--color-muted);
    background: var(--color-bg);
    padding: 3px 8px;
    border-radius: var(--radius-sm);
    transition: all 0.2s;
  }

  .event-card:hover .tag {
    background: color-mix(in srgb, var(--color-primary) 8%, var(--color-bg));
    color: var(--color-text-secondary);
  }

  .source {
    font-size: 0.6rem;
    font-weight: 500;
    color: var(--color-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
</style>
