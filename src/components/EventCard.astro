---
interface Props {
  event: {
    id: number;
    title: string;
    date: string;
    time?: string;
    location: string;
    description?: string;
    category: string;
    tags?: string[];
    url?: string;
    source?: string;
    region?: string;
    isHighlight?: boolean;
  };
  regions?: Record<string, { name: string; emoji: string }>;
}

const { event, regions = {} } = Astro.props;

const date = new Date(event.date);
const day = date.getDate();
const month = date.toLocaleDateString('de-DE', { month: 'short' });
const weekday = date.toLocaleDateString('de-DE', { weekday: 'short' });

const categoryConfig = {
  kinder: { emoji: 'üë∂', label: 'Kinder', color: 'var(--color-kinder)' },
  familie: { emoji: 'üë®‚Äçüë©‚Äçüëß', label: 'Familie', color: 'var(--color-familie)' },
  erwachsene: { emoji: 'üé≠', label: 'Erwachsene', color: 'var(--color-erwachsene)' }
};

const cat = categoryConfig[event.category as keyof typeof categoryConfig] || categoryConfig.familie;
const regionInfo = event.region && regions[event.region];
---

<article 
  class="event-card"
  class:list={[{ 'is-highlight': event.isHighlight }]}
  data-category={event.category}
  data-region={event.region}
  data-location={event.location}
>
  <!-- Date Column -->
  <div class="date-col">
    <div class="date-badge">
      <span class="date-weekday">{weekday}</span>
      <span class="date-day">{day}</span>
      <span class="date-month">{month}</span>
    </div>
    {event.isHighlight && <span class="highlight-star" title="Highlight Event">‚≠ê</span>}
  </div>
  
  <!-- Content Column -->
  <div class="content-col">
    <!-- Header Row -->
    <div class="card-header">
      <span class="category-badge" style={`--cat-color: ${cat.color}`}>
        {cat.emoji} {cat.label}
      </span>
      {event.time && <span class="time-badge">{event.time}</span>}
    </div>
    
    <!-- Title -->
    <h3 class="title">
      {event.url ? (
        <a href={event.url} target="_blank" rel="noopener">{event.title}</a>
      ) : (
        event.title
      )}
    </h3>
    
    <!-- Location -->
    <div class="location">
      <span class="location-pin">üìç</span>
      <span class="location-text">{event.location}</span>
      {regionInfo && (
        <span class="region-badge">{regionInfo.emoji}</span>
      )}
    </div>
    
    <!-- Description -->
    {event.description && (
      <p class="description">{event.description}</p>
    )}
    
    <!-- Footer -->
    <div class="card-footer">
      {event.tags && event.tags.length > 0 && (
        <div class="tags">
          {event.tags.slice(0, 2).map(tag => (
            <span class="tag">#{tag}</span>
          ))}
        </div>
      )}
      {event.source && (
        <span class="source">{event.source}</span>
      )}
    </div>
  </div>
</article>

<style>
  .event-card {
    display: flex;
    gap: 12px;
    background: var(--color-card);
    border-radius: var(--radius-md);
    padding: 14px;
    border: 1px solid var(--color-border);
    transition: all 0.2s ease;
  }

  @media (min-width: 640px) {
    .event-card {
      gap: 16px;
      padding: 16px;
    }
  }

  .event-card:hover {
    box-shadow: var(--shadow-md);
    border-color: transparent;
  }

  .event-card.is-highlight {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border-color: #fcd34d;
  }

  /* Date Column */
  .date-col {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  .date-badge {
    width: 52px;
    padding: 8px 4px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    border-radius: var(--radius-sm);
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    text-align: center;
  }

  @media (min-width: 640px) {
    .date-badge {
      width: 60px;
      padding: 10px 6px;
    }
  }

  .date-weekday {
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.85;
  }

  .date-day {
    font-size: 1.4rem;
    font-weight: 700;
    line-height: 1.1;
  }

  @media (min-width: 640px) {
    .date-day {
      font-size: 1.6rem;
    }
  }

  .date-month {
    font-size: 0.7rem;
    text-transform: uppercase;
    opacity: 0.9;
  }

  .highlight-star {
    font-size: 1rem;
  }

  /* Content Column */
  .content-col {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .category-badge {
    font-size: 0.7rem;
    font-weight: 500;
    padding: 3px 8px;
    border-radius: var(--radius-full);
    background: color-mix(in srgb, var(--cat-color) 15%, transparent);
    color: color-mix(in srgb, var(--cat-color) 80%, black);
  }

  .time-badge {
    font-size: 0.75rem;
    color: var(--color-text-secondary);
    font-weight: 500;
  }

  .title {
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.3;
    color: var(--color-text);
  }

  @media (min-width: 640px) {
    .title {
      font-size: 1.05rem;
    }
  }

  .title a {
    color: inherit;
  }

  .title a:hover {
    color: var(--color-primary);
  }

  .location {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.8rem;
    color: var(--color-text-secondary);
  }

  .location-pin {
    font-size: 0.75rem;
  }

  .region-badge {
    margin-left: 4px;
    font-size: 0.85rem;
  }

  .description {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    padding-top: 4px;
  }

  .tags {
    display: flex;
    gap: 6px;
  }

  .tag {
    font-size: 0.65rem;
    color: var(--color-muted);
    background: var(--color-bg);
    padding: 2px 6px;
    border-radius: var(--radius-sm);
  }

  .source {
    font-size: 0.6rem;
    color: var(--color-muted);
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }
</style>
