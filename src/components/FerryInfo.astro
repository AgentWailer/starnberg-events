---
// Ferry schedule widget for Starnberger See
---

<div class="ferry-widget">
  <div class="ferry-header">
    <div class="ferry-title">
      <span class="ferry-icon">⛴️</span>
      <span>Schiff Possenhofen</span>
    </div>
    <a href="https://www.seenschifffahrt.de/de/starnberger-see/fahrplan/" target="_blank" class="ferry-link">
      Fahrplan →
    </a>
  </div>
  <div class="ferry-body" id="ferry-table">
    <div class="ferry-loading">
      <span class="spinner"></span>
    </div>
  </div>
</div>

<style>
  .ferry-widget {
    background: var(--color-card);
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--color-border-light);
  }

  .ferry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-3) var(--space-4);
    background: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border-light);
  }

  .ferry-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--color-text);
  }

  .ferry-icon {
    font-size: 1rem;
  }

  .ferry-link {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--color-primary);
  }

  .ferry-body {
    min-height: 80px;
  }

  .ferry-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-6);
    color: var(--color-muted);
    font-size: 0.8125rem;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid var(--color-border);
    border-top-color: var(--color-primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  :global(.ferry-row) {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    border-bottom: 1px solid var(--color-border-light);
    font-size: 0.8125rem;
    align-items: center;
  }

  :global(.ferry-row:last-child) {
    border-bottom: none;
  }

  :global(.ferry-time) {
    font-weight: 600;
    color: var(--color-primary);
    font-variant-numeric: tabular-nums;
  }

  :global(.ferry-dir) {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    color: var(--color-text);
    font-weight: 500;
  }

  :global(.ferry-arrow) {
    font-size: 0.75rem;
    opacity: 0.6;
  }

  :global(.ferry-arrival) {
    color: var(--color-muted);
    font-size: 0.75rem;
  }

  :global(.ferry-notice) {
    padding: var(--space-4);
    text-align: center;
    color: var(--color-muted);
    font-size: 0.8125rem;
  }

  :global(.ferry-notice strong) {
    color: var(--color-text-secondary);
    display: block;
    margin-bottom: var(--space-1);
  }

  :global(.ferry-notice a) {
    color: var(--color-primary);
    font-weight: 500;
  }
</style>

<script>
  // Possenhofen ferry schedule (2026 season)
  const schedule = [
    { time: '10:50', dest: 'Tutzing', arrival: '11:14', dir: '↓' },
    { time: '11:30', dest: 'Starnberg', arrival: '12:05', dir: '↑' },
    { time: '12:10', dest: 'Tutzing', arrival: '12:34', dir: '↓' },
    { time: '13:55', dest: 'Tutzing', arrival: '14:19', dir: '↓' },
    { time: '14:25', dest: 'Starnberg', arrival: '15:00', dir: '↑' },
    { time: '15:05', dest: 'Tutzing', arrival: '15:29', dir: '↓' },
    { time: '15:35', dest: 'Starnberg', arrival: '16:10', dir: '↑' },
    { time: '16:30', dest: 'Starnberg', arrival: '17:05', dir: '↑' },
    { time: '17:50', dest: 'Starnberg', arrival: '18:25', dir: '↑' },
  ];

  function isSeason(): boolean {
    const now = new Date();
    const month = now.getMonth() + 1;
    const day = now.getDate();
    return !(month < 4 || month > 10 || (month === 4 && day < 5) || (month === 10 && day > 18));
  }

  function getUpcoming(): typeof schedule {
    const now = new Date();
    const currentMins = now.getHours() * 60 + now.getMinutes();
    
    const upcoming = schedule.filter(s => {
      const [h, m] = s.time.split(':').map(Number);
      return h * 60 + m > currentMins;
    });
    
    return upcoming.length ? upcoming.slice(0, 3) : schedule.slice(0, 3);
  }

  function render(): void {
    const container = document.getElementById('ferry-table');
    if (!container) return;

    if (!isSeason()) {
      container.innerHTML = `
        <div class="ferry-notice">
          <strong>Winterpause</strong>
          Saison 2026: 05.04. – 18.10.
          <br><a href="https://www.seenschifffahrt.de" target="_blank">seenschifffahrt.de</a>
        </div>
      `;
      return;
    }

    const ferries = getUpcoming();
    container.innerHTML = ferries.map(f => `
      <div class="ferry-row">
        <span class="ferry-time">${f.time}</span>
        <span class="ferry-dir">
          <span class="ferry-arrow">${f.dir}</span>
          ${f.dest}
        </span>
        <span class="ferry-arrival">an ${f.arrival}</span>
      </div>
    `).join('');
  }

  let refreshInterval: number | null = null;

  document.addEventListener('DOMContentLoaded', () => {
    render();
    refreshInterval = setInterval(render, 60000);
  });

  // Cleanup interval on navigation
  window.addEventListener('pagehide', () => {
    if (refreshInterval) {
      clearInterval(refreshInterval);
    }
  });
</script>
