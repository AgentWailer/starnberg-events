---
// Elegant info bar for mobile - matches site design
---

<div class="info-bar" id="info-bar">
  <div class="info-bar-inner" id="info-bar-inner">
    <span class="info-item loading">Lädt...</span>
  </div>
</div>

<style>
  .info-bar {
    display: none;
    background: var(--color-primary);
    color: white;
    overflow: hidden;
    position: relative;
  }

  @media (max-width: 767px) {
    .info-bar {
      display: block;
    }
  }

  .info-bar-inner {
    display: flex;
    animation: marquee 25s linear infinite;
    padding: var(--space-3) 0;
  }

  .info-bar-inner:hover,
  .info-bar-inner:active {
    animation-play-state: paused;
  }

  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  .info-bar .info-item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: 0 var(--space-5);
    font-size: 0.8125rem;
    font-weight: 500;
    white-space: nowrap;
    opacity: 0.95;
  }

  .info-bar .info-item::after {
    content: "·";
    margin-left: var(--space-5);
    opacity: 0.4;
  }

  .info-bar .info-item:last-child::after {
    content: none;
  }

  .info-bar .info-value {
    font-weight: 700;
  }

  .info-bar .info-label {
    opacity: 0.7;
    font-weight: 400;
  }

  .info-bar .info-badge {
    background: rgba(255,255,255,0.2);
    padding: 1px 6px;
    border-radius: var(--radius-sm);
    font-size: 0.6875rem;
    font-weight: 700;
    letter-spacing: 0.02em;
  }

  .info-bar .loading {
    opacity: 0.6;
    font-style: italic;
  }
</style>

<script>
  const WEATHER_API = 'https://api.open-meteo.com/v1/forecast?latitude=47.9983&longitude=11.3397&current=temperature_2m,weather_code&daily=sunrise,sunset&timezone=Europe%2FBerlin&forecast_days=1';
  const TRAIN_API = 'https://dbf.finalrewind.org';

  function formatTime(iso: string): string {
    return new Date(iso).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
  }

  async function loadInfo(): Promise<void> {
    const container = document.getElementById('info-bar-inner');
    if (!container) return;

    const items: string[] = [];

    // Weather
    try {
      const res = await fetch(WEATHER_API);
      const data = await res.json();
      const temp = Math.round(data.current?.temperature_2m || 0);
      const sunrise = data.daily?.sunrise?.[0] ? formatTime(data.daily.sunrise[0]) : '';
      const sunset = data.daily?.sunset?.[0] ? formatTime(data.daily.sunset[0]) : '';

      items.push(`<span class="info-item"><span class="info-value">${temp}°</span> <span class="info-label">Starnberg</span></span>`);
      items.push(`<span class="info-item"><span class="info-value">4°</span> <span class="info-label">Wassertemp</span></span>`);
      if (sunrise && sunset) {
        items.push(`<span class="info-item">☀ <span class="info-value">${sunrise}</span> – <span class="info-value">${sunset}</span></span>`);
      }
    } catch {
      items.push(`<span class="info-item">Wetter nicht verfügbar</span>`);
    }

    // Train
    try {
      const res = await fetch(`${TRAIN_API}/Possenhofen.json?version=3`);
      const data = await res.json();
      const train = (data.departures || [])
        .filter((d: any) => !d.isCancelled && d.train.startsWith('S '))
        .slice(0, 1)[0];

      if (train) {
        const dest = train.destination
          .replace(/\s*\([^)]*\)/g, '')
          .replace(/ Hbf$/, '')
          .replace(/^München /, 'M-');
        const delay = train.delayDeparture > 0 ? ` +${train.delayDeparture}` : '';
        
        items.push(`<span class="info-item"><span class="info-badge">S6</span> <span class="info-value">${train.scheduledDeparture}${delay}</span> → ${dest}</span>`);
      }
    } catch {
      // Skip
    }

    // Duplicate for seamless loop
    const content = items.join('');
    container.innerHTML = content + content;
  }

  document.addEventListener('DOMContentLoaded', loadInfo);
</script>
