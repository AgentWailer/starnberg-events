---
// Weekly markets info widget
const markets = [
  { name: 'Starnberg', place: 'Kirchplatz', days: ['Do 7-13h', 'Sa 7-13h'] },
  { name: 'SÃ¶cking', place: 'St. Ulrich', days: ['Fr vormittags'] },
];

// Find next market
const today = new Date();
const dayOfWeek = today.getDay();
const dayMap: Record<string, number> = { Do: 4, Fr: 5, Sa: 6 };

let nextMarket = '';
let daysUntil = 7;

for (const market of markets) {
  for (const dayInfo of market.days) {
    const dayAbbr = dayInfo.split(' ')[0];
    const targetDay = dayMap[dayAbbr];
    if (targetDay !== undefined) {
      let diff = targetDay - dayOfWeek;
      if (diff <= 0) diff += 7;
      if (diff < daysUntil) {
        daysUntil = diff;
        nextMarket = `${dayAbbr} Â· ${market.name}`;
      }
    }
  }
}

const daysText = daysUntil === 1 ? 'morgen' : daysUntil === 0 ? 'heute' : `in ${daysUntil} Tagen`;
---

<div class="market-widget">
  <div class="market-header">
    <span class="market-icon">ðŸ¥¬</span>
    <span class="market-title">WochenmÃ¤rkte</span>
  </div>
  <div class="market-body">
    <div class="market-next">
      <span class="next-label">NÃ¤chster:</span>
      <span class="next-value">{nextMarket}</span>
      <span class="next-when">({daysText})</span>
    </div>
    <div class="market-list">
      {markets.map(m => (
        <div class="market-item">
          <span class="market-name">{m.name}</span>
          <span class="market-days">{m.days.join(' Â· ')}</span>
        </div>
      ))}
    </div>
  </div>
</div>

<style>
  .market-widget {
    background: var(--color-card);
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--color-border-light);
  }

  .market-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border-light);
    font-weight: 600;
    font-size: 0.875rem;
  }

  .market-icon {
    font-size: 1rem;
  }

  .market-body {
    padding: var(--space-4);
  }

  .market-next {
    display: flex;
    align-items: baseline;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-3);
    border-bottom: 1px solid var(--color-border-light);
    font-size: 0.8125rem;
  }

  .next-label {
    color: var(--color-muted);
  }

  .next-value {
    font-weight: 600;
    color: var(--color-text);
  }

  .next-when {
    color: var(--color-muted);
    font-size: 0.75rem;
  }

  .market-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .market-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8125rem;
  }

  .market-name {
    font-weight: 500;
    color: var(--color-text);
  }

  .market-days {
    color: var(--color-muted);
    font-size: 0.75rem;
  }
</style>
