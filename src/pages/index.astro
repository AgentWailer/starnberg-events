---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import TrainInfo from '../components/TrainInfo.astro';
import FilterBar from '../components/FilterBar.astro';
import EventCard from '../components/EventCard.astro';
import eventsData from '../data/events.json';

// Get regions from data or use defaults
const regions = eventsData.regions || {
  "poecking": { "name": "P√∂cking", "emoji": "üè†" },
  "starnberg-ammersee": { "name": "Starnberg-Ammersee", "emoji": "üèîÔ∏è" },
  "muenchen": { "name": "M√ºnchen", "emoji": "üèôÔ∏è" },
  "tegernsee": { "name": "Tegernsee", "emoji": "‚õ∞Ô∏è" },
  "werdenfels": { "name": "Werdenfelser Land", "emoji": "üéø" }
};

// Sort events by date
const events = eventsData.events.sort((a, b) => {
  const dateCompare = a.date.localeCompare(b.date);
  if (dateCompare !== 0) return dateCompare;
  if (!a.time) return 1;
  if (!b.time) return -1;
  return a.time.localeCompare(b.time);
});

// Get unique sources for footer
const sources = [...new Set(events.map(e => e.source).filter(Boolean))];
const sourceCount = sources.length;
---

<Layout title="Events Oberbayern - Veranstaltungen f√ºr Familien">
  <Header lastUpdated={eventsData.lastUpdated} />
  
  <main class="main">
    <TrainInfo station="Possenhofen" stationCode="MPH" />
    
    <FilterBar events={events} regions={regions} />
    
    <section class="events-grid">
      {events.map(event => (
        <EventCard event={event} regions={regions} />
      ))}
    </section>
    
    <footer class="footer">
      <p class="source-info">
        üìä {events.length} Events aus {sourceCount} Quellen
      </p>
      <p class="sources-list">
        {sources.length > 0 ? (
          <>
            Daten von: {' '}
            {sources.includes('beccult') && <a href="https://www.beccult.de" target="_blank">beccult</a>}
            {sources.includes('starnbergammersee') && <a href="https://www.starnbergammersee.de" target="_blank">starnbergammersee.de</a>}
            {sources.includes('muenchen') && <a href="https://www.muenchen.de" target="_blank">muenchen.de</a>}
            {sources.includes('olympiapark') && <a href="https://www.olympiapark.de" target="_blank">olympiapark.de</a>}
            {sources.includes('tegernsee') && <a href="https://www.tegernsee.com" target="_blank">tegernsee.com</a>}
            {sources.includes('gapa') && <a href="https://www.gapa-tourismus.de" target="_blank">gapa.de</a>}
          </>
        ) : (
          <a href="https://www.starnbergammersee.de" target="_blank">starnbergammersee.de</a>
        )}
      </p>
      <p>Made with ‚ù§Ô∏è f√ºr Oberbayern</p>
    </footer>
  </main>
</Layout>

<style>
  .main {
    max-width: 900px;
    margin: 0 auto;
    padding: 1rem;
  }

  .events-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }

  .footer {
    margin-top: 3rem;
    padding: 2rem 1rem;
    text-align: center;
    color: var(--color-muted);
    font-size: 0.9rem;
  }

  .footer p {
    margin: 0.25rem 0;
  }

  .source-info {
    font-weight: 600;
    color: #667eea;
  }

  .sources-list {
    font-size: 0.8rem;
  }

  .sources-list a {
    color: #666;
    margin: 0 4px;
  }

  .sources-list a:hover {
    color: #667eea;
  }
</style>
<!-- Build trigger: 1770111626 -->
